<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Local JS -->
    <script src="../utils/requestHelper.js"></script>
    <script src="../utils/userRequests.js"></script>
    <script src="../utils/utils.js"></script>

    <!-- Local CSS -->
    <link rel="stylesheet" href="../assets/style/main.css">

    <!-- CDN -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script>
        function loadUsers() {
            let userList = document.getElementById('user_list')
            userList.innerHTML = ''
            getAll().then((body) => {
                if(!body.error) {
                    for(user of body.data) {
                        userList.appendChild(userItem(user))
                        userList.appendChild(document.createElement('br'))
                    }
                }
            })
        }

        function userItem(user) {
            let header = document.createElement('H5');
            header.innerText = user.name
            header.className = 'card-header'

            let emailLabel = document.createElement('p')
            emailLabel.className = 'card-text'
            emailLabel.innerHTML = user.email
            
            let deleteButton = document.createElement('button')
            deleteButton.innerHTML = 'Eliminar'
            deleteButton.className = 'btn btn-danger'
            deleteButton.onclick = function() {
                deleteUserFront(user.email)
            }

            let schedulesButton = document.createElement('button')
            schedulesButton.innerHTML = 'Ver horarios'
            schedulesButton.className = 'btn btn-secondary ml-3'
            schedulesButton.onclick = function() {
                goToSchedules(user)
            }

            let body = document.createElement('div')
            body.className = 'card-body'
            body.appendChild(emailLabel)
            if(user.isAdmin) {
                let adminBadge = document.createElement('span')
                adminBadge.className = 'badge badge-success'
                adminBadge.innerHTML = 'Administrador'
                let badgeH = document.createElement('h5')
                badgeH.appendChild(adminBadge)
                body.appendChild(badgeH)
                // body.appendChild(document.createElement('br'))
            }
            body.appendChild(deleteButton)
            body.appendChild(schedulesButton)


            let userDiv = document.createElement('div')
            userDiv.className = 'card'
            userDiv.appendChild(header)
            userDiv.appendChild(body)

            return userDiv
        }
        
        function deleteUserFront(email) {
            deleteUser(email).then((body) => {
                if(!body.error) {
                    loadUsers()
                }
            })
        }

        function createUserForm() {
            let email = document.getElementById('email').value
            let name = document.getElementById('name').value
            let password = document.getElementById('password').value
            let isAdmin = document.getElementById('is_admin').checked
            createUser(name,email,password,isAdmin).then((body) => {
                console.log(body)
                loadUsers()
            })
        }

        function goToSchedules(user) {
            localStorage.setItem('user_id',user._id)
            localStorage.setItem('user_name',user.name)
            window.location.href = "user/index.html"
        }

        window.onload = function() {
            loadUsers()
        }
    </script>
    <title>Rosa Pastel - Admin</title>
</head>
<body>
    <h1>Crear un usuario nuevo</h1>
    <div class="form-group">
        <input type="text" id="email" placeholder="Correo" class="form-control form-control">
    </div>

    <div class="form-group">
        <input type="text" id="name" placeholder="Nombre" class="form-control form-control">
    </div>
    
    <div class="form-group">
        <input type="text" id="password" placeholder="ContraseÃ±a" class="form-control form-control">
    </div>

    <div class="form-check">
        <input type="checkbox" id="is_admin" name="is_admin" class="form-check-input">
        <label>Es administrador: </label>
    </div>
    <br>
    <button onclick="createUserForm()" class="btn btn-primary">Crear usuario</button>
    <hr>


    <h1>Usuarios</h1>
    <div id='user_list'></div>
</body>
</html>